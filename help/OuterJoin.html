<html><head>
<link rel="stylesheet" href="http://categoricaldata.net/css/nstyle.css"><script src="http://categoricaldata.net/js/simple.js"></script></head><body><h1>example OuterJoin</h1><pre>
#Outer joins using java's Optional class

#This is not an outer join per se (it returns A*B rows, rather than A+B rows,
#when A and B don't join at all), but is similar in spirit.  The pedantic version follows.


typeside Ty = literal {
	external_types
		String -&gt; "java.lang.String"
		Nat -&gt; "java.lang.Integer"
		Bool -&gt; "java.lang.Boolean"
		NullableNat -&gt; "java.util.Optional"
	external_parsers
		String -&gt; "x =&gt; x"
		Nat -&gt; "parseInt"
		Bool -&gt; "x =&gt; java.lang.Boolean.parseBool(x)"
		NullableNat -&gt; "x =&gt; java.util.Optional.of(java.lang.Integer.parseInt(x))"
	external_functions
		null : -&gt; NullableNat = "() =&gt; java.util.Optional.empty()"
		inNat : Nat -&gt; NullableNat = "x =&gt; java.util.Optional.of(x)"
		eqNat : Nat, Nat -&gt; Bool = "(x, y) =&gt; x == y"
		ifNat : Bool, NullableNat, NullableNat -&gt; NullableNat = "(b, x, y) =&gt; b ? x : y"
}

schema S = literal : Ty {
	entities
		A B
	attributes
		Aname : A -&gt; String
		Bname : B -&gt; String
		Aid : A -&gt; Nat
		Bid : B -&gt; Nat
}

schema T = literal : Ty {
	entities
		C
	attributes
		CAname : C -&gt; String
		CBname : C -&gt; String
		Cid : C -&gt; NullableNat
}

query OuterJoin = literal : S -&gt; T {
 	entity
	 	C  -&gt; {from a:A b:B
 			  attributes Cid -&gt; ifNat(eqNat(a.Aid, b.Bid), inNat(a.Aid), null)
 			         CAname -&gt; a.Aname
 		     	    CBname -&gt; b.Bname
 		  	}
}

instance I = literal : S {
	generators
		a1 a2 : A
		b2 b3 : B
	equations
		a1.Aname = alice a1.Aid = "1"
		a2.Aname = bob a2.Aid = "2"
		b2.Bname = charlie b2.Bid = "2"
		b3.Bname = dave b3.Bid = "3"
}

instance J = eval OuterJoin I

############################################

schema Sx = literal : sql {
	entities
		Left Right Middle
	foreign_keys
		f: Left -&gt; Middle g: Right -&gt; Middle
	attributes
		attL: Left -&gt; Varchar
		attR: Right -&gt; Varchar
		attM: Middle -&gt; Varchar
}

instance Ix = literal : Sx {
	generators
		l1 l2 l3 l4: Left
		r1 r2: Right
		m1: Middle
	equations
		l1.f=l2.f l2.f=r1.g l3.f=r2.g
		l1.attL="Bob" l1.f.attM="5"
		l2.attL="Carl" l3.attL="Alice"
		l3.f.attM="10" r1.attR="Happy"
		r2.attR="Sad" m1.attM="7"
		l4.attL="Dave" l4.f.attM="6"
}

#Let's do a left outer join

#Step 1: query, remembering the join and the Left

#Step 1a: make the appropriate schema

schema Helper = literal : sql {
	entities
		Joiner Left
	foreign_keys
		h: Joiner-&gt;Left
	attributes
		attL: Left-&gt;Varchar
		attR: Joiner-&gt; Varchar
		attM: Joiner -&gt; Varchar
}

#Step 1b: query it

query findJoin = literal : Sx -&gt; Helper {
 entity
  Joiner -&gt; {
  	from l:Left r:Right
	where
		l.f=r.g
	attributes
		attM -&gt; l.f.attM
		attR -&gt; r.attR
	foreign_keys
		h -&gt; {l -&gt; l }
  }
 entity
  Left -&gt; {
	from l:Left
	attributes attL-&gt;l.attL
  }
}

#Step 2: add it all up

#Step 2a: make the landing schema

schema Landing = literal : sql {
	entities
		Result
	attributes
		attL: Result-&gt;Varchar
		attM: Result-&gt;Varchar
		attR: Result-&gt;Varchar
}

#Step 2b: make a mapping from helper to landing

mapping AddItUp = literal : Helper -&gt; Landing {
	entity
		Joiner -&gt; Result
	foreign_keys
		h -&gt; identity
	attributes
		attM -&gt; attM
		attR -&gt; attR
	entity
		Left -&gt; Result
	attributes
		attL -&gt; attL

}

#Step 3: run

instance Joined = eval findJoin Ix

instance OuterJoinx = sigma AddItUp Joined
</pre> Keywords:<br/></br>			<a href="typesidetypeside_literal.html" >typeside_literal</a><br />
			<a href="instanceeval.html" >eval</a><br />
			<a href="queryquery_literal.html" >query_literal</a><br />
			<a href="schemaschema_literal.html" >schema_literal</a><br />
			<a href="instanceinstance_literal.html" >instance_literal</a><br />
			<a href="instancesigma.html" >sigma</a><br />
			<a href="mappingmapping_literal.html" >mapping_literal</a><br />
<br/>Options:<br/></br>
<br/></br>
<hr/><h3>instance I</h3><div><table id="table410" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>A</b></caption><tr><th onclick="sortTable('table410', 0)">ID</th><th onclick="sortTable('table410', 1)">Aname</th><th onclick="sortTable('table410', 2)">Aid</th></tr><tr><td>0</td><td>alice</td><td>1</td></tr><tr><td>1</td><td>bob</td><td>2</td></tr></table><table id="table411" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>B</b></caption><tr><th onclick="sortTable('table411', 0)">ID</th><th onclick="sortTable('table411', 1)">Bname</th><th onclick="sortTable('table411', 2)">Bid</th></tr><tr><td>2</td><td>charlie</td><td>2</td></tr><tr><td>3</td><td>dave</td><td>3</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance Ix</h3><div><table id="table412" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Left</b></caption><tr><th onclick="sortTable('table412', 0)">ID</th><th onclick="sortTable('table412', 1)">attL</th><th onclick="sortTable('table412', 2)">f</th></tr><tr><td>0</td><td>Bob</td><td>4</td></tr><tr><td>1</td><td>Carl</td><td>4</td></tr><tr><td>2</td><td>Alice</td><td>5</td></tr><tr><td>3</td><td>Dave</td><td>6</td></tr></table><table id="table413" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Middle</b></caption><tr><th onclick="sortTable('table413', 0)">ID</th><th onclick="sortTable('table413', 1)">attM</th></tr><tr><td>4</td><td>5</td></tr><tr><td>5</td><td>10</td></tr><tr><td>6</td><td>6</td></tr><tr><td>7</td><td>7</td></tr></table><table id="table414" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Right</b></caption><tr><th onclick="sortTable('table414', 0)">ID</th><th onclick="sortTable('table414', 1)">attR</th><th onclick="sortTable('table414', 2)">g</th></tr><tr><td>8</td><td>Happy</td><td>4</td></tr><tr><td>9</td><td>Sad</td><td>5</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance Joined</h3><div><table id="table415" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Joiner</b></caption><tr><th onclick="sortTable('table415', 0)">ID</th><th onclick="sortTable('table415', 1)">attR</th><th onclick="sortTable('table415', 2)">attM</th><th onclick="sortTable('table415', 3)">h</th></tr><tr><td>0</td><td>Happy</td><td>5</td><td>3</td></tr><tr><td>1</td><td>Happy</td><td>5</td><td>4</td></tr><tr><td>2</td><td>Sad</td><td>10</td><td>5</td></tr></table><table id="table416" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Left</b></caption><tr><th onclick="sortTable('table416', 0)">ID</th><th onclick="sortTable('table416', 1)">attL</th></tr><tr><td>3</td><td>Bob</td></tr><tr><td>4</td><td>Carl</td></tr><tr><td>5</td><td>Alice</td></tr><tr><td>6</td><td>Dave</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance OuterJoinx</h3><div><table id="table417" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>Result</b></caption><tr><th onclick="sortTable('table417', 0)">ID</th><th onclick="sortTable('table417', 1)">attL</th><th onclick="sortTable('table417', 2)">attM</th><th onclick="sortTable('table417', 3)">attR</th></tr><tr><td>0</td><td>Alice</td><td>10</td><td>Sad</td></tr><tr><td>1</td><td>Carl</td><td>5</td><td>Happy</td></tr><tr><td>2</td><td>Bob</td><td>5</td><td>Happy</td></tr><tr><td>3</td><td>Dave</td><td>?0</td><td>?1</td></tr></table></div><br style="clear:both;"/><hr/><h3>instance J</h3><div><table id="table418" style="float: left; border: 1px solid black; padding: 5px; border-collapse: collapse; margin-right:10px" border="1"  cellpadding="3"><caption><b>C</b></caption><tr><th onclick="sortTable('table418', 0)">ID</th><th onclick="sortTable('table418', 1)">CAname</th><th onclick="sortTable('table418', 2)">CBname</th><th onclick="sortTable('table418', 3)">Cid</th></tr><tr><td>0</td><td>alice</td><td>charlie</td><td></td></tr><tr><td>1</td><td>alice</td><td>dave</td><td></td></tr><tr><td>2</td><td>bob</td><td>charlie</td><td>2</td></tr><tr><td>3</td><td>bob</td><td>dave</td><td></td></tr></table></div><br style="clear:both;"/></body></html>